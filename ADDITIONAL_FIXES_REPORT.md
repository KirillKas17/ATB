# –û—Ç—á–µ—Ç –æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö

## –û–±–∑–æ—Ä –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –±—ã–ª –ø—Ä–æ–≤–µ–¥–µ–Ω —É–≥–ª—É–±–ª–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è —Å–∫—Ä—ã—Ç—ã—Ö –ø—Ä–æ–±–ª–µ–º –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –∫–∞—á–µ—Å—Ç–≤–µ –∫–æ–¥–∞.

## üîÑ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ü–∏–∫–ª–∏—á–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### 1. –ü—Ä–æ–±–ª–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥—É–ª–µ–π
**–§–∞–π–ª**: `domain/strategies/__init__.py`
**–ü—Ä–æ–±–ª–µ–º–∞**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –º–æ–¥—É–ª—è
**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**: 
- –¶–∏–∫–ª–∏—á–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ
- –ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π
- –ù–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
```python
# –ë–´–õ–û (–ø—Ä–æ–±–ª–µ–º–∞—Ç–∏—á–Ω–æ):
_initialize_globals()  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–∑–æ–≤ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ

# –°–¢–ê–õ–û (–±–µ–∑–æ–ø–∞—Å–Ω–æ):
def initialize_strategy_module() -> bool:
    """–Ø–≤–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π."""
    return _initialize_globals()
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω—ã —Ü–∏–∫–ª–∏—á–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.

## üõ°Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 2. –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ eval()
**–§–∞–π–ª—ã**: 
- `infrastructure/repositories/position_repository.py`
- `infrastructure/repositories/trading/trading_repository.py`

**–ü—Ä–æ–±–ª–µ–º–∞**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `eval()` –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
**–£—è–∑–≤–∏–º–æ—Å—Ç—å**: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞ (Critical Security Risk)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
```python
# –ë–´–õ–û (–û–ü–ê–°–ù–û):
metadata = eval(metadata_str) if metadata_str else {}

# –°–¢–ê–õ–û (–ë–ï–ó–û–ü–ê–°–ù–û):
import ast
metadata = ast.literal_eval(metadata_str) if metadata_str else {}
```

**–ó–∞—â–∏—Ç–∞**: –î–æ–±–∞–≤–ª–µ–Ω –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –º–µ—Ç–æ–¥ `_parse_metadata_safely()` —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∏—Å–∫–ª—é—á–µ–Ω–∏–π.

### 3. –°–ª–∏—à–∫–æ–º –æ–±—â–∏–µ except –±–ª–æ–∫–∏
**–§–∞–π–ª—ã**: –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ —Å `except:` –∏ `except Exception:`

**–ü—Ä–æ–±–ª–µ–º–∞**: –°–∫—Ä—ã—Ç–∏–µ –æ—à–∏–±–æ–∫ –∏ –∑–∞—Ç—Ä—É–¥–Ω–µ–Ω–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
```python
# –ë–´–õ–û (–ø—Ä–æ–±–ª–µ–º–∞—Ç–∏—á–Ω–æ):
except:
    pass

# –°–¢–ê–õ–û (—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ):
except (RuntimeError, IndexError, AttributeError) as e:
    logger.warning(f"Could not copy weights during model evolution: {e}")
```

## ‚ö° –ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 4. –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ —Ü–∏–∫–ª—ã
**–§–∞–π–ª—ã**: 50+ —Ñ–∞–π–ª–æ–≤ —Å –ø–∞—Ç—Ç–µ—Ä–Ω–æ–º `for i in range(len(...))`

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —ç–ª–µ–º–µ–Ω—Ç–∞–º –∏ –∏–Ω–¥–µ–∫—Å–∞–º
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
```python
# –ë–´–õ–û (–Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ):
for i in range(len(values)):
    process(i, values[i])

# –°–¢–ê–õ–û (—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ):
for i, value in enumerate(values):
    process(i, value)
```

### 5. –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã
**–§–∞–π–ª—ã**: –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ —Å `SELECT *`

**–ü—Ä–æ–±–ª–µ–º–∞**: –ò–∑–±—ã—Ç–æ—á–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö, –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
```sql
-- –ë–´–õ–û (–Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ):
SELECT * FROM signals WHERE 1=1

-- –°–¢–ê–õ–û (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ):
SELECT id, pair, signal_type, strength, confidence, 
       source, timestamp, metadata FROM signals WHERE 1=1
```

### 6. –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
**–§–∞–π–ª**: `shared/math_utils.py`

**–ü—Ä–æ–±–ª–µ–º–∞**: –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
```python
# –ë–´–õ–û (–º–µ–¥–ª–µ–Ω–Ω–æ):
result = np.zeros_like(data)
for i in range(len(data)):
    if i < window:
        result[i] = np.nan
    else:
        window_data = data[i - window : i]
        result[i] = (data[i] - np.mean(window_data)) / np.std(window_data)

# –°–¢–ê–õ–û (–±—ã—Å—Ç—Ä–æ):
result = np.full_like(data, np.nan, dtype=float)
for i in range(window, len(data)):
    window_data = data[i - window : i]
    window_mean = np.mean(window_data)
    window_std = np.std(window_data)
    if window_std > 0:
        result[i] = (data[i] - window_mean) / window_std
```

## üí° Code Smells –∏ –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã

### 7. Wildcard –∏–º–ø–æ—Ä—Ç—ã
**–§–∞–π–ª**: `domain/strategies/examples.py`

**–ü—Ä–æ–±–ª–µ–º–∞**: `from domain.entities.strategy import *`
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –Ø–≤–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –∫–ª–∞—Å—Å–æ–≤

### 8. –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ —ç–ª–µ–º–µ–Ω—Ç–∞–º
**–§–∞–π–ª**: `shared/abstractions/base_repository.py`

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä—è–º–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ `existing[0]` –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
```python
# –ë–´–õ–û (–æ–ø–∞—Å–Ω–æ):
existing = self.find_by_criteria(**kwargs)
if existing:
    return existing[0]

# –°–¢–ê–õ–û (–±–µ–∑–æ–ø–∞—Å–Ω–æ):
existing = self.find_one_by_criteria(**kwargs)
if existing:
    return existing
```

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–æ–±–ª–µ–º:
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**: 2 –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- **–ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**: 50+ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- **–¶–∏–∫–ª–∏—á–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: 1 —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞
- **Code smells**: 20+ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- **–ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã**: 10+ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã

### –í–ª–∏—è–Ω–∏–µ –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: ‚¨ÜÔ∏è –ö—Ä–∏—Ç–∏—á–Ω–æ —É–ª—É—á—à–µ–Ω–æ (—É—Å—Ç—Ä–∞–Ω–µ–Ω—ã RCE —É—è–∑–≤–∏–º–æ—Å—Ç–∏)
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: ‚¨ÜÔ∏è –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–µ–Ω–æ
- **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å**: ‚¨ÜÔ∏è –£–ª—É—á—à–µ–Ω–æ –∑–∞ —Å—á–µ—Ç —è–≤–Ω—ã—Ö –∏–º–ø–æ—Ä—Ç–æ–≤ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: ‚¨ÜÔ∏è –£–ª—É—á—à–µ–Ω–æ –∑–∞ —Å—á–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö except –±–ª–æ–∫–æ–≤
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å**: ‚¨ÜÔ∏è –£–ª—É—á—à–µ–Ω–æ –∑–∞ —Å—á–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

## üéØ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ï—â–µ –Ω–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ, –Ω–æ –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ SELECT * –∑–∞–ø—Ä–æ—Å—ã** (50+ —Ñ–∞–π–ª–æ–≤) - —Ç—Ä–µ–±—É–µ—Ç –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
2. **–û–±—â–∏–µ Exception –±–ª–æ–∫–∏** (100+ —Å–ª—É—á–∞–µ–≤) - —Ç—Ä–µ–±—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ —Ç–∏–ø–∞–º –æ—à–∏–±–æ–∫
3. **–ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ —Ü–∏–∫–ª—ã** (–µ—â–µ ~30 —Å–ª—É—á–∞–µ–≤) - –º–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–ª—å—à–µ

### –ü—Ä–æ—Ü–µ–¥—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
1. **Code Review Process**: –í–Ω–µ–¥—Ä–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `eval()`, `exec()`
2. **Static Analysis**: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ code smells
3. **Performance Testing**: –î–æ–±–∞–≤–∏—Ç—å –±–µ–Ω—á–º–∞—Ä–∫–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—É—Ç–µ–π
4. **Security Audits**: –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–∏

## üèÜ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –≤—ã—è–≤–∏–ª –∏ —É—Å—Ç—Ä–∞–Ω–∏–ª –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:

‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã RCE —É—è–∑–≤–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ eval()  
‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ü–∏–∫–ª—ã –∏ SQL –∑–∞–ø—Ä–æ—Å—ã  
‚úÖ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã —Ü–∏–∫–ª–∏—á–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏  
‚úÖ **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã code smells –∏ –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã  

–ü—Ä–æ–µ–∫—Ç —Ç–µ–ø–µ—Ä—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç enterprise-—Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

---

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞**: –î–µ–∫–∞–±—Ä—å 2024  
**–°—Ç–∞—Ç—É—Å**: –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã ‚úÖ  
**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏**: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —É–ª—É—á—à–µ–Ω–∏–π