# –û—Ç—á–µ—Ç –æ –ø—Ä–æ–≤–µ—Ä–∫–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ external_services

## –û–±–∑–æ—Ä

–ü—Ä–æ–≤–µ–¥–µ–Ω–∞ –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `infrastructure/external_services` –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª —Å–∏—Å—Ç–µ–º—ã ATB.

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏

### ‚úÖ –£—Å–ø–µ—à–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### 1. DI Container Integration
**–§–∞–π–ª**: `application/di_container_refactored.py`
- ‚úÖ –ò–º–ø–æ—Ä—Ç—ã –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- ‚úÖ ServiceLocator –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã

```python
# External Services
from infrastructure.external_services.bybit_client import BybitClient
from infrastructure.external_services.account_manager import AccountManager

# –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
bybit_client = providers.Singleton(
    BybitClient,
    api_key=config.bybit.api_key,
    api_secret=config.bybit.api_secret,
    testnet=config.bybit.testnet
)

account_manager = providers.Singleton(
    AccountManager,
    bybit_client=bybit_client
)
```

#### 2. Infrastructure Layer Integration
**–§–∞–π–ª**: `infrastructure/__init__.py`
- ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç—ã –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –æ–±–µ—Å–ø–µ—á–µ–Ω–∞

```python
from .external_services import BinanceExchangeService, BybitExchangeService

__all__ = [
    # External Services
    "BybitExchangeService",
    "BinanceExchangeService",
    # ...
]
```

#### 3. Resource Manager Integration
**–§–∞–π–ª**: `infrastructure/entity_system/core/resource_manager.py`
- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ `_init_external_services()`
- ‚úÖ Health-check –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ Circuit breaker –∏ retry –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

#### 4. Main Application Integration
**–§–∞–π–ª**: `main.py`
- ‚úÖ –ò–º–ø–æ—Ä—Ç DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ ServiceLocator
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

#### 1. –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∞–¥–∞–ø—Ç–µ—Ä—ã
**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–∞—Ä—ã–µ –∏–º–ø–æ—Ä—Ç—ã —Å—Å—ã–ª–∞—é—Ç—Å—è –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

**–§–∞–π–ª—ã —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏**:
- `tests/security/test_security.py` - –∏–º–ø–æ—Ä—Ç `BybitClient`, `AccountManager`
- `tests/integration/test_trading_flow.py` - –∏–º–ø–æ—Ä—Ç `BybitClient`
- `tests/e2e/test_complete_trading_session.py` - –∏–º–ø–æ—Ä—Ç `BybitClient`

**–†–µ—à–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω—ã –∞–¥–∞–ø—Ç–µ—Ä—ã –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

#### 2. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∏–º–ø–æ—Ä—Ç–æ–≤ –≤ __init__.py
**–ü—Ä–æ–±–ª–µ–º–∞**: –í `infrastructure/external_services/__init__.py` –µ—Å—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã

```python
# Legacy adapters for backward compatibility
from .bybit_client import BybitClientAdapter  # ‚ùå –§–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
from .order_manager import OrderManagerAdapter  # ‚ùå –§–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
from .risk_analysis_service import RiskAnalysisServiceAdapter  # ‚ùå –§–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
from .technical_analysis_service import TechnicalAnalysisServiceAdapter  # ‚ùå –§–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
```

**–†–µ—à–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω—ã –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∞–¥–∞–ø—Ç–µ—Ä—ã

### üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

#### 1. –°–æ–∑–¥–∞–Ω BybitClient Adapter
**–§–∞–π–ª**: `infrastructure/external_services/bybit_client.py`
```python
class BybitClient(ExchangeProtocol):
    """–ê–¥–∞–ø—Ç–µ—Ä BybitClient –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏."""
    
    def __init__(self, api_key: str, api_secret: str, testnet: bool = False):
        # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å —á–µ—Ä–µ–∑ —Ñ–∞–±—Ä–∏–∫—É
        self.exchange_service = ExchangeServiceFactory.create_bybit_service(
            api_key=api_key,
            api_secret=api_secret,
            testnet=testnet
        )
```

#### 2. –°–æ–∑–¥–∞–Ω AccountManager Adapter
**–§–∞–π–ª**: `infrastructure/external_services/account_manager.py`
```python
class AccountManager(AccountProtocol):
    """–ê–¥–∞–ø—Ç–µ—Ä AccountManager –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏."""
    
    def __init__(self, exchange_client: Any, order_manager: Optional[Any] = None, 
                 risk_config: Optional[Dict[str, Any]] = None):
        # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å
        self.account_service = ProductionAccountManager(config)
```

### üìä –°—Ç–∞—Ç—É—Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ø–æ –º–æ–¥—É–ª—è–º

| –ú–æ–¥—É–ª—å | –°—Ç–∞—Ç—É—Å | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | –¢–µ—Å—Ç—ã |
|--------|--------|------------|-------|
| **exchanges** | ‚úÖ –ì–æ—Ç–æ–≤ | ‚úÖ DI Container | ‚úÖ –†–∞–±–æ—Ç–∞—é—Ç |
| **ml** | üîÑ –ß–∞—Å—Ç–∏—á–Ω–æ | ‚úÖ DI Container | ‚ö†Ô∏è –¢—Ä–µ–±—É—é—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |
| **account** | üîÑ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ | ‚ö†Ô∏è –ê–¥–∞–ø—Ç–µ—Ä —Å–æ–∑–¥–∞–Ω | ‚ö†Ô∏è –¢—Ä–µ–±—É—é—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |
| **order** | ‚úÖ –ì–æ—Ç–æ–≤ | ‚úÖ DI Container | ‚úÖ –†–∞–±–æ—Ç–∞—é—Ç |
| **risk** | üîÑ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ | ‚ö†Ô∏è –ù–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω | ‚ùå –ù–µ —Å–æ–∑–¥–∞–Ω—ã |
| **technical** | üîÑ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ | ‚ö†Ô∏è –ù–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω | ‚ùå –ù–µ —Å–æ–∑–¥–∞–Ω—ã |

### üîÑ –¢—Ä–µ–±—É—é—â–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

#### 1. ML Services
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞
- ‚úÖ FeatureEngineer —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- ‚úÖ ModelManager —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- ‚ö†Ô∏è –ù—É–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å ProductionMLService
- ‚ö†Ô∏è –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å MLServiceAdapter

#### 2. Account Management
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞
- ‚úÖ –ê–¥–∞–ø—Ç–µ—Ä —Å–æ–∑–¥–∞–Ω
- ‚ö†Ô∏è –ù—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å ProductionAccountManager
- ‚ö†Ô∏è –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å AccountManagerAdapter

#### 3. Risk Analysis
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞
- ‚ö†Ô∏è –ù—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å ProductionRiskAnalysisService
- ‚ö†Ô∏è –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å RiskAnalysisServiceAdapter

#### 4. Technical Analysis
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞
- ‚ö†Ô∏è –ù—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å ProductionTechnicalAnalysisService
- ‚ö†Ô∏è –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å TechnicalAnalysisServiceAdapter

### üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –†–∞–±–æ—Ç–∞—é—â–∏–µ —Ç–µ—Å—Ç—ã
- ‚úÖ `tests/unit/test_order_manager.py` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–æ–≤—ã–π OrderManager
- ‚úÖ `tests/test_order_manager.py` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–æ–≤—ã–π OrderManager

#### –¢—Ä–µ–±—É—é—â–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- ‚ö†Ô∏è `tests/security/test_security.py` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ä—ã–µ –∏–º–ø–æ—Ä—Ç—ã
- ‚ö†Ô∏è `tests/integration/test_trading_flow.py` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ä—ã–µ –∏–º–ø–æ—Ä—Ç—ã
- ‚ö†Ô∏è `tests/e2e/test_complete_trading_session.py` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ä—ã–µ –∏–º–ø–æ—Ä—Ç—ã

### üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

#### 1. –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
1. **–ó–∞–≤–µ—Ä—à–∏—Ç—å ML —Å–µ—Ä–≤–∏—Å—ã** - –æ–Ω–∏ –∫—Ä–∏—Ç–∏—á–Ω—ã –¥–ª—è —Å–∏—Å—Ç–µ–º—ã
2. **–û–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –∞–¥–∞–ø—Ç–µ—Ä—ã
3. **–î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã** - –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã

#### 2. –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
1. **–ó–∞–≤–µ—Ä—à–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã** - account, risk, technical
2. **–°–æ–∑–¥–∞—Ç—å –ø–æ–ª–Ω—ã–µ –∞–¥–∞–ø—Ç–µ—Ä—ã** - –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
3. **–î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –º–µ—Ç—Ä–∏–∫–∏ –∏ –∞–ª–µ—Ä—Ç—ã

#### 3. –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
1. **–ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –Ω–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã** - –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥
2. **–£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –∞–¥–∞–ø—Ç–µ—Ä–æ–≤** - –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ, rate limiting

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

- **–û–±—â–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å**: 60%
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**: 80%
- **–¢–µ—Å—Ç—ã**: 40%
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: 90%

### üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è `external_services` –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª —Å–∏—Å—Ç–µ–º—ã **—á–∞—Å—Ç–∏—á–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞**. –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (exchanges, order) –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç. –û—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ç—Ä–µ–±—É—é—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ —Å–æ–∑–¥–∞–Ω–∏—è –∞–¥–∞–ø—Ç–µ—Ä–æ–≤ –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –ó–∞–≤–µ—Ä—à–∏—Ç—å ML —Å–µ—Ä–≤–∏—Å—ã –∏ –æ–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã. 