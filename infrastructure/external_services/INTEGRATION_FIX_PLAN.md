# –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### üî¥ 1. –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Ç–∏–ø–æ–≤ Order

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Ç–∏–ø–æ–≤ –º–µ–∂–¥—É `order_manager.Order` –∏ `exchange.Order`

**–§–∞–π–ª—ã —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏**:
- `infrastructure/external_services/exchange.py`
- `infrastructure/external_services/order_manager.py`

**–û—à–∏–±–∫–∏**:
```
infrastructure\external_services\exchange.py:265: error: Incompatible return value type 
(got "infrastructure.external_services.order_manager.Order", expected "infrastructure.external_services.exchange.Order")
```

**–†–µ—à–µ–Ω–∏–µ**:
1. –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ç–∏–ø—ã –≤ `domain/entities/trading.py`
2. –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –µ–¥–∏–Ω–æ–≥–æ —Ç–∏–ø–∞
3. –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è Order

### üî¥ 2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ risk –∏ technical —Å–µ—Ä–≤–∏—Å–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞**: –°–µ—Ä–≤–∏—Å—ã —Å–æ–∑–¥–∞–Ω—ã, –Ω–æ –Ω–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

**–†–µ—à–µ–Ω–∏–µ**:
1. –î–æ–±–∞–≤–∏—Ç—å –≤ `application/di_container_refactored.py`
2. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ —Ç–æ—Ä–≥–æ–≤—ã–µ use cases
3. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã

### üî¥ 3. –ù–µ–ø–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–µ—Ä–≤–∏—Å—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Ç–æ—Ä–≥–æ–≤–æ–º —Ü–∏–∫–ª–µ

**–†–µ—à–µ–Ω–∏–µ**:
1. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `application/use_cases/`
2. –î–æ–±–∞–≤–∏—Ç—å –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–æ—Ä–≥–æ–≤—ã–π —Ü–∏–∫–ª
3. –°–æ–∑–¥–∞—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

## –ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –®–∞–≥ 1: –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–∏–ø–æ–≤ Order

```python
# 1. –û–±–Ω–æ–≤–∏—Ç—å domain/entities/trading.py
from dataclasses import dataclass
from datetime import datetime
from typing import Optional

@dataclass
class Order:
    """–ï–¥–∏–Ω—ã–π —Ç–∏–ø Order –¥–ª—è –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã."""
    id: str
    trading_pair: str
    side: str
    order_type: str
    volume: float
    price: Optional[float]
    status: str
    created_at: datetime
    
    # –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏
    def validate(self) -> bool:
        """–í–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ä–¥–µ—Ä–∞."""
        return (
            self.volume > 0 and
            self.price is None or self.price > 0 and
            self.status in ["pending", "filled", "cancelled", "rejected"]
        )
```

### –®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã

```python
# 2. –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –µ–¥–∏–Ω–æ–≥–æ —Ç–∏–ø–∞
from domain.entities.trading import Order  # –ï–¥–∏–Ω—ã–π –∏–º–ø–æ—Ä—Ç

# –£–¥–∞–ª–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è Order
```

### –®–∞–≥ 3: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å risk –∏ technical —Å–µ—Ä–≤–∏—Å—ã

```python
# 3. –î–æ–±–∞–≤–∏—Ç—å –≤ application/di_container_refactored.py
from infrastructure.external_services.risk_analysis_service import RiskAnalysisServiceAdapter
from infrastructure.external_services.technical_analysis_service import TechnicalAnalysisServiceAdapter

# –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
risk_analysis_service = providers.Singleton(
    RiskAnalysisServiceAdapter
)

technical_analysis_service = providers.Singleton(
    TechnicalAnalysisServiceAdapter
)
```

### –®–∞–≥ 4: –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã

```python
# 4. –°–æ–∑–¥–∞—Ç—å tests/unit/test_external_services_integration.py
import pytest
from infrastructure.external_services import (
    BybitClient, AccountManager, OrderManager,
    RiskAnalysisServiceAdapter, TechnicalAnalysisServiceAdapter
)

class TestExternalServicesIntegration:
    """–¢–µ—Å—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤."""
    
    def test_bybit_client_integration(self):
        """–¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ BybitClient."""
        client = BybitClient("test_key", "test_secret", testnet=True)
        assert client is not None
    
    def test_account_manager_integration(self):
        """–¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ AccountManager."""
        # –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
    
    def test_order_manager_integration(self):
        """–¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ OrderManager."""
        # –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
    
    def test_risk_analysis_integration(self):
        """–¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ RiskAnalysisService."""
        # –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
    
    def test_technical_analysis_integration(self):
        """–¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ TechnicalAnalysisService."""
        # –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
```

### –®–∞–≥ 5: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ —Ç–æ—Ä–≥–æ–≤—ã–µ use cases

```python
# 5. –û–±–Ω–æ–≤–∏—Ç—å application/use_cases/manage_risk.py
from infrastructure.external_services.risk_analysis_service import RiskAnalysisServiceAdapter

class DefaultRiskManagementUseCase:
    def __init__(self, risk_service, market_service, risk_analysis):
        self.risk_service = risk_service
        self.market_service = market_service
        self.risk_analysis = risk_analysis  # RiskAnalysisServiceAdapter
```

### –®–∞–≥ 6: –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```python
# 6. –°–æ–∑–¥–∞—Ç—å infrastructure/external_services/monitoring.py
class ExternalServicesMonitor:
    """–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤."""
    
    def __init__(self):
        self.services = {}
        self.metrics = {}
    
    async def monitor_health(self):
        """–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–æ–≤."""
        for service_name, service in self.services.items():
            try:
                health = await service.health_check()
                self.metrics[service_name] = health
            except Exception as e:
                self.metrics[service_name] = {"status": "error", "error": str(e)}
```

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π (–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ)
1. –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–∏–ø–æ–≤ Order
2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
3. –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è risk –∏ technical —Å–µ—Ä–≤–∏—Å–æ–≤

### üü° –í—ã—Å–æ–∫–∏–π (–í —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è)
1. –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤
2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Ç–æ—Ä–≥–æ–≤—ã–µ use cases
3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### üü¢ –°—Ä–µ–¥–Ω–∏–π (–í —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏)
1. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
3. –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

## –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–ª–∞–Ω–∞:

### ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –æ—à–∏–±–æ–∫
- –ù–µ—Ç –æ—à–∏–±–æ–∫ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
- –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Ç–∏–ø–æ–≤
- –í—Å–µ –∏–º–ø–æ—Ä—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç

### ‚úÖ –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
- –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Ç–æ—Ä–≥–æ–≤–æ–º —Ü–∏–∫–ª–µ
- –ï—Å—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏

### ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
- 100% –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏
- –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º

## –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏

### –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ 1: –¢–∏–ø—ã
- [ ] –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã —Ç–∏–ø—ã Order
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
- [ ] –í—Å–µ –∏–º–ø–æ—Ä—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç

### –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ 2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [ ] –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≤ DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- [ ] –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≤ —Ç–æ—Ä–≥–æ–≤—ã—Ö use cases
- [ ] –ï—Å—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –°–æ–∑–¥–∞–Ω—ã –±–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –ï—Å—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

### –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ 4: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [ ] –ï—Å—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- [ ] –ï—Å—Ç—å —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

## –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

### –†–∏—Å–∫–∏
1. **–ù–∞—Ä—É—à–µ–Ω–∏–µ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏**
   - –ú–∏—Ç–∏–≥–∞—Ü–∏—è: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–¥–∞–ø—Ç–µ—Ä—ã

2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
   - –ú–∏—Ç–∏–≥–∞—Ü–∏—è: –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é

3. **–°–ª–æ–∂–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**
   - –ú–∏—Ç–∏–≥–∞—Ü–∏—è: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–∫–∏ –∏ —Å—Ç–∞–±—ã

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –æ–±–µ—Å–ø–µ—á–∏—Ç:

1. **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã** - —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
2. **–ü–æ–ª–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
3. **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞** - —Ç–µ—Å—Ç—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: 1-2 –¥–Ω—è –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º, 1 –Ω–µ–¥–µ–ª—è –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –ù–∞—á–∞—Ç—å —Å —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤ Order –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ. 